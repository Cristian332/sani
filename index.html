<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Reporte de Anomalías en Sanitarios</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<header>
		<h1>Reporte de Anomalías en Sanitarios</h1>
	</header>

	<form action="https://formsubmit.co/cris3312.muoz@gmail.com" method="POST" enctype="multipart/form-data" id="sheetdb-form">

		<label for="lugar">Lugar</label>
		<input type="text" id="lugar" name="lugar" value="Baño primer piso administrativo" readonly>
		<input type="text" name="Lugar_reporte" value="Baño primer piso administrativo" style="display: none;" readonly>

		<label for="problema">Seleccione el problema:</label>
		<select id="problema" name="problema" required>
			<option value="">Seleccione una opción</option>
			<option value="Fuga de agua">Fuga de agua</option>
			<option value="Inodoro tapado">Inodoro tapado</option>
			<option value="Lavabo tapado">Lavabo tapado</option>
			<option value="Falta de papel higiénico">Falta de papel higiénico</option>
			<option value="5Otro">Otro</option>
		 </select>

		<label for="otroProblema">Describa el problema:</label>
		<input type="text" id="otroProblema" name="otroProblema">

		<label for="imagen">Adjunte una imagen (opcional):</label>
		<input type="file" id="imagen" name="imagen">

		<input type="submit" id="generar-reporte" value="Generar reporte">
		<input type="submit" value="Enviar">

	</form>

	<script>
		var generarReporteButton = document.getElementById('generar-reporte');
generarReporteButton.addEventListener('click', function(event) {
    event.preventDefault();

    var formData = new FormData(document.getElementById("sheetdb-form"));

    var fechaActual = new Date().toLocaleDateString();
    var horaActual = new Date().toLocaleTimeString();

    formData.append('fecha', fechaActual);
    formData.append('hora', horaActual);

    var url1 = 'https://formsubmit.co/cris3312.muoz@gmail.com';
    var url2 = 'https://sheetdb.io/api/v1/lcao2h8gjnmzx';
    var requestOptions = {
        method: 'POST',
        body: formData,
        redirect: 'follow'
    };

    // send data to url1 and url2 simultaneously
    Promise.all([
        fetch(url1, requestOptions),
        fetch(url2, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formDataToObject(formData))
        })
    ]).then(function(responses) {
        alert('El reporte ha sido generado.');
    }).catch(function(error) {
        alert('Ha ocurrido un error al generar el reporte.');
        console.error(error);
    });
});


		// convert form data to object
		function formDataToObject(formData) {
      var object = {};
      formData.forEach(function(value, key){
        object[key] = value;
      });
      return object;
    }

    var generarReporteButton = document.getElementById('generar-reporte');
    generarReporteButton.addEventListener('click', function(event) {
      event.preventDefault();

      ;

      // send data to url1 and url2 simultaneously
      Promise.all([
        fetch(url1, requestOptions),
        fetch(url2, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formDataToObject(formData))
        })
      ]).then(function(responses) {
        alert('El reporte ha sido generado.');
      }).catch(function(error) {
        alert('Ha ocurrido un error al generar el reporte.');
        console.error(error);
      });
    });
</script>
</body>
</html>